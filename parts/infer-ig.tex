\section{Interaction Graph inference}
\resume{The Process Hitting can be used to finely model a system by defining cooperations or studying its behavior using the available tools. One can then decide to translate this model back to Thomas' modeling, and the Interaction Graph inference is the first step to perform this. It relies on an exhaustive approach that looks for possible influences of a gene on the others given all possible configurations. This part gives good results.}

In order to infer a complete BRN, one has to find the Interaction Graph first, as some constraints on the Parametrization rely on it. Inferring the Interaction Graph consists in determining the influence of all components on each of its successors.

\todo{say this is an abstraction step, where we want to infer the global influence of components
between each others}

\todo{outline}

This section assumes a global Process Hitting $(\PHs,\PHl,\PHa)$ on which the IG inference is to be
performed.

\subsection{Focal Processes}

Many of the inferences defined in the rest of this paper rely on the knowledge of \emph{focal
processes} w.r.t. a given context, \ie{} a set of processes that are potentially present.
When such a context applies, we expect to (always) reach one focal process in a bound number of
actions.

Let us first define as $\PHa(a,\ctx)$ the set of actions on the sort $a$ having their hitter in
$\ctx$ (\pref{eq:PHa-ctx}).
\begin{equation}
\PHa(a,\ctx) \DEF \{ \PHfrappe{b_i}{a_j}{a_k}\in\PHa \mid b_i\in\ctx \}
\label{eq:PHa-ctx}
\end{equation}

We denote $\focals(a,\ctx)$ the set of focal processes of sort $a$ in the context $\ctx$
(\pref{def:focals}).

\begin{definition}[$\focals(a,\ctx)$]\label{def:focals}
Let us define the digraph $G = (L_a, V)$ where arcs are the bounces within the sort $a$
triggered by actions having their hitter in $\ctx$:
\[V \DEF \{(a_j,a_k)\in (\PHl_a \times \PHl_a) \mid 
			\exists\PHfrappe{b_i}{a_j}{a_k}\in \PHa(a,\ctx)\}\enspace.\]
$\focals(a,\ctx)$ is the set of focal processes of sort $a$ in the context $\ctx$:
\[
\focals(a,\ctx) \DEF
\begin{cases}
\{ a_i \in \PHl_a \mid \nexists (a_i,a_j)\in V\} & \text{if $G$ is acyclic},\\
\emptyset & \text{otherwise.}\\
\end{cases}
\]
\end{definition}

We say that a state $s\in\PHl$ \emph{matches} a context $\ctx$ if and only if
$\forall a\in\PHsort(\ctx), \PHget{s}{a}\in\ctx$, where $\PHsort(\ctx)$ denotes the set of sorts of
processes in $\ctx$.
From \pref{def:focals}, it derives that:
\begin{enumerate}
\item if $\focals(a,\ctx)=\emptyset$, there exists a 
state $s\in \PHl$ matching $\ctx$ such that $\forall n\in\mathbb N$ there 
exists a sequence of $n+1$ actions in $\PHa(a,\ctx)$ successively playable in $s$.
\item if $\focals(a,\ctx)\neq\emptyset$, for all
state $s\in \PHl$ matching $\ctx$,
for any sequence of actions $h^1,\dots,h^k$ in $\PHa(a,\ctx)$ successively playable in $s$,
either
\begin{itemize}
\item $(s\play h^1\cdots h^k)[a] \in \focals(a,\ctx)$;
\item or, $\exists h^{k+1}\in \PHa(a,\ctx)$ playable in $s\play h^1\cdots h^k$.
\end{itemize}
Moreover $k\leq|\PHa(a,\ctx)|$ (no cycle of actions possible).
\end{enumerate}

\begin{example*}
In the Process Hitting of \pref{fig:runningPH-1}, we obtain:
\begin{align*}
\focals(a,\{b_0,c_0\}) &= \{ a_0 \}
&
\focals(a,\{b_1,c_1\}) &= \{ a_2 \}
&
\focals(a,\{b_1,c_0\}) &= \emptyset\enspace.
\end{align*}
\end{example*}

\subsection{Well-formed Process Hitting for Interaction Graph Inference}

The inference of an IG from a Process Hitting assumes there the Process Hitting defines two types of
sorts:
the sorts corresponding to BRN components, and the cooperative sorts.
This lead to the characterization of the \emph{well-formed} Process Hitting for IG inference.

The identification of sorts modelling components rely on the observation that their processes
represent (ordered) qualitative levels.
Hence an action on such a sort cannot make it bounce to process at a distance more than one.
The set of sorts satisfying such a condition is referred to as $\Gamma$
(\pref{eq:PH-components}).
Therefore, in the rest of this paper, $\Gamma$ denotes the set of components of the BRN to infer.

\begin{equation}
\Gamma \DEF \{a \in \PHs \mid \nexists \PHfrappe{b_i}{a_j}{a_k} \in \PHa, |j - k| > 1\} \\
\label{eq:PH-components}
\end{equation}

Any sorts that do not act as a component should then be treated as a cooperative sort.
\todo{briefly explain the role of a cooperative sort
and \pref{pro:wf-cooperative-sort}}
The set of sorts having an action on a given sort $a$ is given by 
$\PHdirectpredec{a}$ (\pref{eq:ph_direct_predec}).

\begin{equation}
\forall a \in \PHs, \PHdirectpredec{a} \DEF \{b \in \PHs \mid \exists \PHfrappe{b_i}{a_j}{a_k}\in\PHa \}
\label{eq:ph_direct_predec}
\end{equation}

\begin{property}[Well-formed cooperative sort]\label{pro:wf-cooperative-sort}
A sort $\upsilon\in\PHs$ is a well-formed cooperative sort if and only if
each configuration $\sigma$ of its predecessors leads $\upsilon$ to a unique focal process,
denoted by $\upsilon[\sigma]$:
\[
\forall \sigma \in \prod_{a\in\PHdirectpredec{\upsilon}} \PHl_{a},
\focals(\upsilon,\sigma\cup \PHl_\upsilon) = \{ \upsilon[\sigma] \}\]
\end{property}

Such a property allows a large variety of definition of a cooperative sort, but
for the sake of simplicity, does not allow the existence of multiple focal processes.
While this may be easily extended to (the condition becomes 
$\focals(\upsilon,\sigma\cup \PHl_\upsilon)\neq\emptyset$), it makes some hereafter equations a bit
more complex to read as they should handle set of focal processes instead of a unique focal process.


Finally, \pref{pro:wf-ph} sums up the conditions for a Process Hitting to be suitable for IG
inference.
In addition of having either component sorts or well-formed cooperative sorts, we also impose that
sorts being not hit (\ie{}, serving as invariant environment) are components.

\begin{property}[Well-formed Process Hitting for IG inference]\label{pro:wf-ph}
A Process Hitting is well-formed for IG inference if and only if the following conditions are
verified:
\begin{itemize}
\item 
each sort $a\in\PHs$ either belongs to $\Gamma$, or is a well-formed cooperative sort;
\item 
there is no cycle between cooperative sorts
(the digraph $(\Sigma,\{(a,b)\in(\Sigma\times\Sigma)\mid \exists \PHfrappe{a_i}{b_j}{b_k}\in\PHa
\wedge a\neq b\wedge \{a,b\}\cap\Gamma=\emptyset \})$ is
acyclic);
\item 
sorts having no action hitting them belong to $\Gamma$
($\{ a \in \Sigma\mid \nexists \PHfrappe{b_i}{a_j}{a_k}\in\PHa\} \subset \Gamma$).
\end{itemize}
\end{property}

\begin{comment}
\begin{center}
\begin{tikzpicture}
% Sortes
\TSetSortLabel{a}{b}
\TSetSortLabel{b}{c}
\TSetSortLabel{z}{a}
\TSetSortLabel{ab}{bc}
\TSort{(0,3)}{a}{2}{l}
\TSort{(0,0)}{b}{2}{l}
\TSetTick{ab}{0}{00}
\TSetTick{ab}{1}{01}
\TSetTick{ab}{2}{10}
\TSetTick{ab}{3}{11}
\TSort{(3,0.5)}{ab}{4}{r}
\TSort{(6,1)}{z}{3}{r}

% Actions de m√†j de ab
\THit{a_1}{}{ab_0}{.west}{ab_2}
\THit{a_1}{}{ab_1}{.west}{ab_3}
\path[bounce,bend left] \TBounce{ab_0}{}{ab_2}{.south} \TBounce{ab_1}{}{ab_3}{.south};

\THit{a_0}{}{ab_2}{.west}{ab_0}
\THit{a_0}{}{ab_3}{.west}{ab_1}
\path[bounce,bend right] \TBounce{ab_2}{}{ab_0}{.north} \TBounce{ab_3}{}{ab_1}{.north};

\THit{b_0}{}{ab_3}{.west}{ab_2}
\THit{b_0}{}{ab_1}{.west}{ab_0}
\THit{b_1}{}{ab_0}{.west}{ab_1}
\THit{b_1}{}{ab_2}{.west}{ab_3}
\path[bounce,bend right] \TBounce{ab_1}{}{ab_0}{.north} \TBounce{ab_3}{}{ab_2}{.north};
\path[bounce,bend left] \TBounce{ab_0}{}{ab_1}{.south} \TBounce{ab_2}{}{ab_3}{.south};

% Arcs sortant de ab
\THit{ab_2}{}{z_1}{.north west}{z_2}
\THit{ab_2}{}{z_0}{.north west}{z_1}
\path[bounce,bend left] \TBounce{z_1}{}{z_2}{.south} \TBounce{z_0}{}{z_1}{.south};
\THit{ab_3}{}{z_2}{.south west}{z_1}
\THit{ab_3}{}{z_0}{.north west}{z_1}
\path[bounce,bend left] \TBounce{z_2}{bend right}{z_1}{.north} \TBounce{z_0}{}{z_1}{.south};
\THit{ab_1}{}{z_2}{.south west}{z_1}
\THit{ab_1}{}{z_1}{.south west}{z_0}
\path[bounce,bend right] \TBounce{z_2}{}{z_1}{.north} \TBounce{z_1}{}{z_0}{.north};
\THit{ab_0}{}{z_2}{.south west}{z_1}
\THit{ab_0}{}{z_1}{.south west}{z_0}
\path[bounce,bend right] \TBounce{z_2}{}{z_1}{.north} \TBounce{z_1}{}{z_0}{.north};
\end{tikzpicture}
\end{center}
\end{comment}

\subsection{Interaction Inference}

At this point we can divide the set of sorts $\PHs$ into components ($\Gamma$) and cooperative sorts
($\PHs \setminus \Gamma$) that will not appear in the Interaction Graph. In (\ref{eq:ph_direct_predec})
we define the notion of direct predecessors in a Process Hitting by considering the actions between
sorts, and we extend it in (\ref{ph_predec}) to a broader notion of predecessor, where we define the
influence of sort to another by considering actions and possible cooperative sorts. This latter can
be compared to the notion of predecessors of Gene Networks. 
\begin{align}
\begin{split}
\forall a \in \PHs, \PHpredec{a} &\DEF \{b \in \PHs \mid \exists n \in \mathbb{N}^*, \exists (c^k)_{k \in \llbracket 0 ; n \rrbracket} \in \PHs^{n+1}, \\
                                   & \quad \quad c^0 = b \wedge c^n = a \\
                                   & \quad \quad \wedge \forall k \in \llbracket 0 ; n-1 \rrbracket,
								   c^k \in \PHdirectpredec{c^{k+1}} \cap (\PHs\setminus\Gamma)\}
\end{split}
\label{ph_predec}
\\
\forall a\in \PHs, \PHpredecgene{a} & \DEF \PHpredec{a} \cap \Gamma
\label{eq:regulators}
\end{align}

We now aim to determine what kind of influence gets each component from its component predecessors.
Let $a \in \Gamma$ be a component and $b \in \PHpredecgene{b}$ a component that may influence it.
We define $\gamma(b\rightarrow a)$ the set of components cooperating with $b$ (including $b$ itself)
to hit $a$ in \eqref{eq:cooperating-with-b}.
\begin{align}
\begin{split}
\gamma(b\rightarrow a) \DEF \{ b \} \cup \{ c \in \Gamma \mid 
			\exists \upsilon\in(\PHs\setminus\Gamma),
				\upsilon\in\PHpredec{a} \wedge \{b,c\}\subset\PHpredec{\upsilon} \}
\end{split}
\label{eq:cooperating-with-b}
\end{align}

%The point of this approach is to derive, in a given sub-state, the influence of $a$ by comparing the focal states of $b$ in each state of $a$. For a given sub-state $\sigma \in C_{a \rightarrow b}$ of component predecessors of $b$ and a given process $a_i \in \PHs_a$ of $a$, we define the context of each predecessor $c \in \PHpredec{b}$ of $b$. This context is only the chosen process for $a$ (\ref{sub-state_a_predec}) and all component predecessors (\ref{sub-state_gene_predec}). In case of a cooperative sort, the context is the process that represents the sub-state of its predecessors (\ref{sub-state_cs_predec}).

\todo{Explain the need for \pref{eq:proc-ctx}}

Given $c\in\PHs$ and a sub-state $\sigma\in\prod_{a\in\PHsort(\sigma)} \PHl_a$
such that $c\in\Gamma\Rightarrow c\in\PHsort(\sigma) \wedge
c\notin\Gamma\Rightarrow \PHpredecgene{c}\subset\PHsort(\sigma)$,
$c[\sigma]$ refers to the process of sort $c$ recursively defined in \pref{eq:proc-ctx}:
\begin{equation}
c[\sigma] \DEF
\begin{cases}
\sigma[c] & \text{if } c\in\PHsort(\sigma) \\
\focals(c, \PHl_c \cup \{ d[\sigma] \mid d\in\PHdirectpredec{c} \})
	& \text{otherwise.}
\end{cases}
\label{eq:proc-ctx}
\end{equation}
As there is no cycle between cooperative sorts, the above recursion always terminates.

\todo{explain the inference with $\focals$}

\todo{We say the set $\focals(a,\ctx)\neq\emptyset$ is an interval iff \ldots}
We also define an order between intervals with the relation $\intervalless$
(\pref{eq:interval-compare}).
\begin{align}
\begin{split}
  [a_{i,1} ; a_{i,2}] \intervalless [a_{j,1} ; a_{j,2}] \EQDEF & (a_{i,1} < a_{j,1} \wedge a_{i,2}
  \leq a_{j,2}) \\
  &\vee (a_{i,1} \leq a_{j,1} \wedge a_{i,2} < a_{j,2})
\end{split}
\label{eq:interval-compare}
\end{align}

Let us define two sub-states $\sigma,\sigma'\in \prod_{c\in\gamma(b\rightarrow a)} \PHl_c$ such that
$\sigma[b]=b_i$, $\sigma'[b]=b_j$ with $i < j$,
and $\sigma[c]=\sigma'[c]$ for each $c\in\PHpredecgene{a}, c\neq b$.
With $\ctx[\sigma] = \{ c[\sigma] \in \PHproc \mid c\in\PHdirectpredec{a} \wedge b\in \PHpredecgene{c}
\}$:
\begin{itemize}
\item if $\focals(a,\ctx[\sigma])$ or $\focals(a,\ctx[\sigma'])$ is not a non-empty interval, then
			$b\xrightarrow{\pm}a\in \IG$; otherwise,
\item $\focals(a,\ctx[\sigma]) \intervalless \focals(a,\ctx[\sigma']) \Longrightarrow
			b\xrightarrow{+}a\in \IG$;
\item $\focals(a,\ctx[\sigma']) \intervalless \focals(a,\ctx[\sigma]) \Longrightarrow
			b\xrightarrow{-}a\in \IG$.
\end{itemize}

In the particular case where $\PHpredecgene{a}=\{a\}$,
we skip the above rules if $\focals(a,\PHl_a)$ is a non-empty interval.

\todo{threshold}

\todo{Discuss of errors/inconclusive cases}

\subsection{Examples}
\todo{Illustrate with the example}

